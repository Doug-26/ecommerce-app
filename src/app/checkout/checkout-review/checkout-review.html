<div class="review-container">
  <h4 class="mb-4">Review Your Order</h4>

  <!-- Order Items Review -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Order Items</h6>
    </div>
    <div class="card-body">
      @for (item of cartItems(); track item.product.id) {
        <div class="d-flex align-items-center mb-3 pb-3 border-bottom">
          <img [src]="item.product.imageUrl" [alt]="item.product.name" 
               class="me-3" style="width: 60px; height: 60px; object-fit: cover;">
          <div class="flex-grow-1">
            <h6 class="mb-1">{{ item.product.name }}</h6>
            <p class="text-muted mb-0">Quantity: {{ item.quantity }}</p>
          </div>
          <div class="text-end">
            <strong>${{ (item.product.price * item.quantity).toFixed(2) }}</strong>
          </div>
        </div>
      }
    </div>
  </div>

  <!-- Shipping Address Review -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Shipping Address</h6>
    </div>
    <div class="card-body">
      @if (shippingAddress()) {
        <p class="mb-0">
          <strong>{{ shippingAddress()!.firstName }} {{ shippingAddress()!.lastName }}</strong><br>
          {{ shippingAddress()!.address }}<br>
          {{ shippingAddress()!.city }}, {{ shippingAddress()!.state }} {{ shippingAddress()!.zipCode }}<br>
          {{ shippingAddress()!.country }}
          @if (shippingAddress()!.phone) {
            <br>{{ shippingAddress()!.phone }}
          }
        </p>
      }
    </div>
  </div>

  <!-- Payment Method Review -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Payment Method</h6>
    </div>
    <div class="card-body">
      @if (paymentMethod()) {
        <p class="mb-0">
          <strong>{{ paymentMethod()!.type | titlecase }}</strong>
          @if (paymentMethod()!.cardNumber) {
            <br>**** **** **** {{ paymentMethod()!.cardNumber?.slice(-4) }}
          }
        </p>
      }
    </div>
  </div>

  <!-- Order Summary -->
  <div class="card mb-4">
    <div class="card-header">
      <h6 class="mb-0">Order Summary</h6>
    </div>
    <div class="card-body">
      <div class="d-flex justify-content-between mb-2">
        <span>Subtotal:</span>
        <span>${{ checkoutSummary().subtotal.toFixed(2) }}</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Shipping:</span>
        <span>
          @if (checkoutSummary().shipping === 0) {
            <span class="text-success">FREE</span>
          } @else {
            ${{ checkoutSummary().shipping.toFixed(2) }}
          }
        </span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Tax:</span>
        <span>${{ checkoutSummary().tax.toFixed(2) }}</span>
      </div>
      <hr>
      <div class="d-flex justify-content-between fw-bold fs-5">
        <span>Total:</span>
        <span>${{ checkoutSummary().total.toFixed(2) }}</span>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="d-flex justify-content-between">
    <button type="button" class="btn btn-outline-secondary" (click)="onBack.emit()">
      <i class="fas fa-arrow-left me-2"></i>Back to Payment
    </button>
    <button type="button" class="btn btn-success btn-lg" 
            (click)="placeOrder()" [disabled]="isProcessing()">
      @if (isProcessing()) {
        <span class="spinner-border spinner-border-sm me-2"></span>
        Processing Order...
      } @else {
        <i class="fas fa-check me-2"></i>Place Order
      }
    </button>
  </div>
</div>
